<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bori Chat EN</title>
</head>
<body>
  <div id="messages"></div>
  <script>
    function sanitizeHTML(html) {
      if (typeof html !== 'string') return '';
      // Remove script and style tags
      html = html.replace(/<\/?(?:script|style)[^>]*>/gi, '');
      // Remove inline event handlers
      html = html.replace(/ on\w+=("[^"]*"|'[^']*'|[^\s>]+)/gi, '');
      // Sanitize anchor hrefs
      html = html.replace(/<a\b[^>]*>/gi, tag => {
        const hrefMatch = tag.match(/href\s*=\s*("([^"]*)"|'([^']*)'|([^\s>]+))/i);
        if (hrefMatch) {
          const hrefVal = hrefMatch[2] || hrefMatch[3] || hrefMatch[4];
          const hasProtocol = /^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(hrefVal);
          const isSafe = !hasProtocol || /^https?:/i.test(hrefVal);
          if (!isSafe) {
            tag = tag.replace(/\s*href\s*=\s*("[^"]*"|'[^']*'|[^\s>]+)/i, '');
          }
        }
        return tag;
      });
      return html;
    }

    if (typeof window !== 'undefined') {
      window.addEventListener('message', (event) => {
        if (!event.data || typeof event.data.text !== 'string') return;
        const container = document.getElementById('messages');
        if (!container) return;
        const div = document.createElement('div');
        div.innerHTML = sanitizeHTML(event.data.text);
        container.appendChild(div);
      });
    }
  </script>
</body>
</html>
